# コントリビューションガイド

日報管理ツール（dailyReport）への貢献に興味を持っていただき、ありがとうございます。このドキュメントでは、プロジェクトへの貢献方法について説明します。

## 目次

- [はじめに](#はじめに)
- [開発環境のセットアップ](#開発環境のセットアップ)
- [コーディング規約](#コーディング規約)
- [変更の提案方法](#変更の提案方法)
- [プルリクエストのガイドライン](#プルリクエストのガイドライン)
- [テスト](#テスト)
- [ドキュメント](#ドキュメント)
- [リリースプロセス](#リリースプロセス)

## はじめに

### プロジェクトの目標

日報管理ツールは、以下の目標を持っています:

- シンプルで使いやすい日報管理
- macOS標準ツールを活用した軽量な実装
- 拡張性の高いアーキテクチャ
- 最小限の依存関係

### 貢献の種類

以下のような貢献を歓迎します:

- バグ報告
- 機能提案
- コードの改善
- ドキュメントの改善
- テストの追加
- 翻訳

## 開発環境のセットアップ

### 前提条件

- macOS 10.14以降
- bash（標準インストール済み）
- jq（`brew install jq`でインストール）
- Git

### リポジトリのクローン

```bash
git clone https://github.com/yourusername/dailyReport.git
cd dailyReport
```

### 初期セットアップ

```bash
# 実行権限を付与
chmod +x *.sh

# 設定ファイルを編集（必要に応じて）
vim config.sh

# plistファイルを生成
./generate_plist.sh
```

### 動作確認

```bash
# 日報編集スクリプトのテスト
./edit_report.sh

# 朝のサマリのテスト
./morning_summary.sh

# 夕方のリマインダーのテスト
./evening_reminder.sh

# 詳細表示のテスト
./show_report_details.sh
```

## コーディング規約

### シェルスクリプト

#### 基本方針

- POSIX互換性を保つ（可能な限り）
- macOS固有の機能を使用する場合は明示的にコメントする
- エラーハンドリングを適切に行う

#### ファイル構造

```bash
#!/bin/bash

# スクリプトの説明
# このスクリプトは〜を行います

# 設定ファイルを読み込む
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "${SCRIPT_DIR}/config.sh"

# 関数定義
function_name() {
    # 関数の説明
    local variable_name="value"

    # 処理内容
}

# メイン処理
```

#### 命名規則

- 変数名: `UPPER_CASE`（グローバル変数）、`lower_case`（ローカル変数）
- 関数名: `snake_case`
- ファイル名: `snake_case.sh`

#### コメント

```bash
# 単一行コメント: 処理の説明

# 複数行の説明が必要な場合:
# 1行目
# 2行目
# 3行目

# 複雑なjq処理には詳細な説明を付ける
# 例: タスクIDの最大値を取得し、+1して次のIDを生成
TASK_ID_COUNTER=$(echo "$TODAY_TASKS" | jq -r '[.[] | .id | scan("[0-9]+") | tonumber] | max // 0' | awk '{print $1+1}')
```

#### エラーハンドリング

```bash
# jqのチェック
if ! command -v jq &> /dev/null; then
    echo "エラー: jqが必要です。インストールしてください: brew install jq"
    exit 1
fi

# ファイルの存在チェック
if [ ! -f "$FILE_PATH" ]; then
    echo "エラー: ファイルが見つかりません: $FILE_PATH"
    exit 1
fi

# 日付形式の検証
if ! [[ "$TARGET_DATE" =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
    echo "エラー: 日付は YYYY-MM-DD 形式で指定してください"
    exit 1
fi
```

### JSON構造

#### スキーマの一貫性

日報JSONファイルは以下のスキーマに従う必要があります:

```json
{
  "date": "YYYY-MM-DD",
  "tasks": [
    {
      "id": "task-XXX",
      "title": "string",
      "hours": 0.0,
      "memo": "string",
      "priority": "low|medium|high",
      "status": "pending|completed",
      "created_at": "YYYY-MM-DDTHH:MM:SS"
    }
  ],
  "notes": ["string"],
  "time_tracking": {
    "start_time": null,
    "end_time": null,
    "breaks": []
  }
}
```

#### 後方互換性

新しいフィールドを追加する場合:

- 既存のフィールドは削除しない
- jqの処理で`// default_value`を使用してデフォルト値を設定
- ドキュメントを更新

### ドキュメント

#### Markdown形式

- 見出しレベル: `#`（H1）はタイトルのみ、`##`（H2）以降をセクションで使用
- コードブロック: 言語を明示（\`\`\`bash、\`\`\`json など）
- リンク: 相対パスを使用

## 変更の提案方法

### Issueの作成

バグ報告や機能提案は、GitHubのIssueで行ってください。

#### バグ報告テンプレート

```markdown
## バグの概要
簡潔にバグの内容を記述

## 再現手順
1. ステップ1
2. ステップ2
3. ステップ3

## 期待される動作
どのように動作すべきか

## 実際の動作
実際にどのように動作したか

## 環境
- macOSバージョン:
- jqバージョン:
- その他関連情報:

## ログ・エラーメッセージ
```
関連するログやエラーメッセージ
```
```

#### 機能提案テンプレート

```markdown
## 機能の概要
提案する機能の概要

## 動機
なぜこの機能が必要か

## 提案する実装方法
どのように実装するか（オプション）

## 代替案
他に考えられる方法（オプション）
```

## プルリクエストのガイドライン

### ブランチ戦略

- `master`: 安定版
- `feature/機能名`: 新機能の開発
- `fix/バグ名`: バグ修正
- `docs/ドキュメント名`: ドキュメントの更新

### プルリクエストの作成

1. フォークして開発ブランチを作成

```bash
git checkout -b feature/新機能名
```

2. 変更をコミット

```bash
git add .
git commit -m "feat: 新機能の追加"
```

3. プッシュ

```bash
git push origin feature/新機能名
```

4. プルリクエストを作成

### コミットメッセージ

コミットメッセージは以下の形式に従ってください:

```
<type>: <subject>

<body>

<footer>
```

#### Type

- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: フォーマット、セミコロンの欠落など（コードの動作に影響しない変更）
- `refactor`: リファクタリング
- `test`: テストの追加・修正
- `chore`: ビルドプロセスやツールの変更

#### 例

```
feat: 月次サマリ機能を追加

- 月ごとの総工数を集計
- タスク完了率を表示
- CSVエクスポート機能

Closes #123
```

### プルリクエストのチェックリスト

- [ ] コードがコーディング規約に従っている
- [ ] 既存のテストがすべて通過する
- [ ] 新しいテストを追加した（該当する場合）
- [ ] ドキュメントを更新した（該当する場合）
- [ ] 後方互換性を保っている

## テスト

### 手動テスト

変更を行った場合、以下のテストを実施してください:

#### 基本機能テスト

```bash
# 1. 日報の作成
./edit_report.sh

# 2. 朝のサマリ表示
./morning_summary.sh

# 3. 夕方のリマインダー
./evening_reminder.sh

# 4. 詳細表示
./show_report_details.sh
```

#### エッジケーステスト

```bash
# 1. 存在しない日付
./edit_report.sh 2099-12-31

# 2. 不正な日付形式
./edit_report.sh invalid-date

# 3. 空の日報ファイル
echo "{}" > 2025/11/2025-11-22.json
./show_report_details.sh 2025-11-22
```

### 自動テスト（将来の計画）

現在、自動テストフレームワークは実装されていませんが、以下のような追加を検討しています:

- シェルスクリプト用のテストフレームワーク（bats-coreなど）
- JSON検証テスト
- 統合テスト

## ドキュメント

### ドキュメントの種類

- `README.md`: プロジェクトの概要と基本的な使い方
- `docs/architecture.md`: システムアーキテクチャの詳細
- `docs/troubleshooting.md`: トラブルシューティングガイド
- `docs/CONTRIBUTING.md`: このドキュメント

### ドキュメントの更新

以下の場合、ドキュメントの更新が必要です:

- 新機能の追加
- 既存機能の変更
- 設定ファイルの変更
- エラーメッセージの変更
- 依存関係の変更

### スクリプト内のコメント

複雑な処理には必ずコメントを追加してください:

```bash
# タスクIDの自動採番
# 既存のタスクから最大IDを取得し、+1して次のIDを生成
# 例: task-001, task-002 が存在する場合、task-003 を生成
TASK_ID_COUNTER=$(echo "$TODAY_TASKS" | jq -r '[.[] | .id | scan("[0-9]+") | tonumber] | max // 0' | awk '{print $1+1}')
```

## リリースプロセス

### バージョニング

セマンティックバージョニング（Semantic Versioning）に従います:

- `MAJOR`: 後方互換性のない変更
- `MINOR`: 後方互換性のある機能追加
- `PATCH`: 後方互換性のあるバグ修正

### リリース手順

1. 変更ログを更新
2. バージョン番号を更新
3. タグを作成

```bash
git tag -a v1.0.0 -m "Release version 1.0.0"
git push origin v1.0.0
```

4. GitHubでリリースノートを作成

## コミュニティ

### 質問・議論

- GitHub Discussions: 機能の議論や質問
- GitHub Issues: バグ報告や機能提案

### コードレビュー

プルリクエストのレビューは、以下の観点で行います:

- コードの品質
- パフォーマンス
- セキュリティ
- ドキュメント
- テストカバレッジ

## ライセンス

このプロジェクトにコントリビュートすることで、あなたの貢献がプロジェクトと同じライセンスの下で公開されることに同意したものとみなします。

## お問い合わせ

質問やサポートが必要な場合は、GitHubのIssueまたはDiscussionsでお気軽にお問い合わせください。

---

貢献していただき、ありがとうございます！
